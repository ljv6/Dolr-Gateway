<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dolr Pay | Ø¨ÙˆØ§Ø¨Ø© ØªÙˆØ±ÙŠØ¯ Ø¯ÙˆÙ„Ø±</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #020b13; 
            --card-bg: #0a1622;
            --primary: #3b82f6;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --border: #1e293b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }

        body {
            background-color: var(--bg-dark);
            background: radial-gradient(circle at center, #0a1b2d 0%, #020b13 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--text-main);
        }

        .container { width: 100%; max-width: 450px; }

        .card {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border);
            text-align: center;
        }

        header img { width: 80px; border-radius: 15px; margin-bottom: 1rem; border: 1px solid var(--primary); }
        header h1 { font-size: 1.4rem; font-weight: 800; margin-bottom: 1.5rem; }

        .products-list { display: grid; gap: 10px; margin-bottom: 1.5rem; }
        .product-card {
            background: #111e2d;
            border: 1px solid var(--border);
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: 0.3s;
        }
        .product-card:hover, .product-card.active { border-color: var(--primary); background: #0d1a29; }
        .product-card h3 { font-size: 0.9rem; font-weight: 700; }
        .product-card span { color: var(--primary); font-weight: 800; }

        #payment-section { display: none; margin-top: 1.5rem; border-top: 1px solid var(--border); padding-top: 1.5rem; }
        .form-group { margin-bottom: 1rem; text-align: right; }
        label { display: block; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 5px; }
        input {
            width: 100%; padding: 0.8rem; border: 1px solid var(--border);
            border-radius: 10px; background: #111e2d; color: white; text-align: right; outline: none;
        }
        input:focus { border-color: var(--primary); }

        .btn {
            width: 100%; padding: 1rem; background: var(--primary);
            color: white; border: none; border-radius: 10px; font-weight: 700;
            cursor: pointer; margin-top: 1rem; transition: 0.3s;
        }
        .btn:disabled { background: #1e293b; cursor: not-allowed; }

        #loader { display: none; margin-top: 10px; font-size: 0.8rem; color: var(--primary); }
    </style>
</head>
<body>

    <div class="container">
        <div class="card">
            <header>
                <img src="IMG_7454.jpeg" alt="Dolr Logo">
                <h1>Ø¨ÙˆØ§Ø¨Ø© ØªÙˆØ±ÙŠØ¯ Ø¯ÙˆÙ„Ø± Dolr Pay</h1>
            </header>

            <div class="products-list">
                <div class="product-card" onclick="selectItem(this, 'Ù…Ù†ØªØ¬ Ø§Ù„Ù†Øª STC', 45)">
                    <h3>Ù…Ù†ØªØ¬ Ø§Ù„Ù†Øª STC</h3> <span>45 Ø±ÙŠØ§Ù„</span>
                </div>
                <div class="product-card" onclick="selectItem(this, 'Ø³Ù†Ø§Ø¨ Ø±Ø³Ù…ÙŠ (3 Ø£Ø´Ù‡Ø±)', 16)">
                    <h3>Ø³Ù†Ø§Ø¨ Ø±Ø³Ù…ÙŠ 3 Ø£Ø´Ù‡Ø±</h3> <span>16 Ø±ÙŠØ§Ù„</span>
                </div>
                <div class="product-card" onclick="selectItem(this, 'Ø³Ù†Ø§Ø¨ Ø±Ø³Ù…ÙŠ (Ø³Ù†Ø©)', 72)">
                    <h3>Ø³Ù†Ø§Ø¨ Ø±Ø³Ù…ÙŠ Ø³Ù†Ø©</h3> <span>72 Ø±ÙŠØ§Ù„</span>
                </div>
                <div class="product-card" onclick="selectItem(this, 'ChatGPT Ø³Ù†Ø©', 25)">
                    <h3>ChatGPT Ø³Ù†Ø©</h3> <span>25 Ø±ÙŠØ§Ù„</span>
                </div>
            </div>

            <div id="payment-section">
                <h3 id="display-name" style="color: var(--primary); margin-bottom: 1rem; font-size: 1rem;"></h3>
                <form id="mainPayForm">
                    <div class="form-group"><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label><input type="text" id="custName" required></div>
                    <div class="form-group"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><input type="email" id="custEmail" required></div>
                    <div class="form-group"><label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="tel" id="custPhone" placeholder="9665xxxxxxxx" required></div>
                    <button type="submit" class="btn" id="submitBtn">ØªØ£ÙƒÙŠØ¯ ÙˆØ¯ÙØ¹ Ø¢Ù…Ù†</button>
                    <div id="loader">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù…Ù†ØµØ© Ø§Ù„Ø¯ÙØ¹...</div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const CONFIG = {
            MID: "983c9669-9278-4dd1-950f-8b8fbb0a14d2",
            M_PASS: "7ceb6437-92bc-411b-98fa-be054b39eaba",
            BOT_TOKEN: "8254444681:AAHYJz1CtqVTT1ovCVUOPCckj3AySLAs8UI",
            CHAT_ID: "591768998"
        };

        let selectedProduct = { name: '', price: 0 };

        function selectItem(el, name, price) {
            document.querySelectorAll('.product-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            selectedProduct = { name, price };
            document.getElementById('display-name').innerText = `Ø·Ù„Ø¨: ${name} (${price} Ø±ÙŠØ§Ù„)`;
            document.getElementById('payment-section').style.display = 'block';
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ´ÙÙŠØ± MD5
        function md5(s) {
            var k=[],i=0;for(;i<64;)k[i]=0|(Math.abs(Math.sin(++i))*4294967296);
            var b=[1732584193,-271733879,-1732584194,271733878],h=[b[0],b[1],b[2],b[3]],j,temp,f,k1,s1;
            s=unescape(encodeURIComponent(s));var w=s.length,g=[(w+8>>6)+1<<4],e=0;for(;e<w;e++)g[e>>2]|=s.charCodeAt(e)<<(e%4<<3);
            g[e>>2]|=128<<(e%4<<3);g[g.length-2]=w*8;for(i=0;i<g.length;i+=16){
                var a=h[0],b1=h[1],c=h[2],d=h[3];for(j=0;j<64;j++){
                    if(j<16){f=(b1&c)|(~b1&d);k1=j}else if(j<32){f=(d&b1)|(~d&c);k1=(5*j+1)%16}else if(j<48){f=b1^c^d;k1=(3*j+5)%16}else{f=c^(b1|~d);k1=(7*j)%16}
                    temp=d;d=c;c=b1;b1=b1+rotateLeft((a+f+k[j]+(g[i+k1]||0)), [7,12,17,22,5,9,14,20,4,11,16,23,6,10,15,21][(j>>4)*4+j%4]);a=temp;
                }h[0]+=a;h[1]+=b1;h[2]+=c;h[3]+=d;
            }
            function rotateLeft(n,s){return(n<<s)|(n>>>(32-s))}
            return h.map(v=> {
                var hex="";for(var i=0;i<4;i++)hex+=((v>>(i*8))&255).toString(16).padStart(2,"0");
                return hex;
            }).join("");
        }

        async function sha1(m) {
            const buf = new TextEncoder().encode(m);
            const hash = await crypto.subtle.digest('SHA-1', buf);
            return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        document.getElementById('mainPayForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const loader = document.getElementById('loader');
            
            btn.disabled = true;
            loader.style.display = 'block';

            const amount = selectedProduct.price.toFixed(2);
            const orderId = "DOLR-" + Date.now();
            const desc = `Tawreed: ${selectedProduct.name}`;
            const name = document.getElementById('custName').value;
            const email = document.getElementById('custEmail').value;
            const phone = document.getElementById('custPhone').value;

            // 1. Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
            const tMsg = `ğŸ’° *Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø¨ÙˆØ§Ø¨Ø© ØªÙˆØ±ÙŠØ¯ Ø¯ÙˆÙ„Ø±*\n---\nğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬: ${selectedProduct.name}\nğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº: ${amount} Ø±ÙŠØ§Ù„\nğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${name}\nğŸ“± Ø§Ù„Ø¬ÙˆØ§Ù„: ${phone}\n---\n_Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø¨Ù†Ùƒ..._`;
            fetch(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/sendMessage?chat_id=${CONFIG.CHAT_ID}&text=${encodeURIComponent(tMsg)}&parse_mode=Markdown`);

            // 2. ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù‡Ø§Ø´ Ø§Ù„Ø£ÙƒÙŠØ¯ Ù„Ù€ Edfapay (SALE + orderId + amount + currency + desc + password)
            const rawString = ("SALE" + orderId + amount + "SAR" + desc + CONFIG.M_PASS).toUpperCase();
            const md5Hash = md5(rawString);
            const finalHash = await sha1(md5Hash);

            // 3. Ø¨Ù†Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±Ø³Ù…ÙŠ
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = 'https://api.edfapay.com/payment/initiate';

            const fields = {
                action: "SALE",
                edfa_merchant_id: CONFIG.MID,
                order_id: orderId,
                order_amount: amount,
                order_currency: "SAR",
                order_description: desc,
                payer_first_name: name,
                payer_last_name: "Customer",
                payer_email: email,
                payer_phone: phone,
                payer_country: "SA",
                payer_city: "Riyadh",
                payer_address: "Online",
                payer_zip: "12345",
                payer_ip: "127.0.0.1",
                term_url_3ds: window.location.href,
                success_url: window.location.href,
                failure_url: window.location.href,
                req_token: "N",
                hash: finalHash
            };

            for (const key in fields) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = fields[key];
                form.appendChild(input);
            }

            document.body.appendChild(form);
            
            // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ø¶Ù…Ø§Ù† ÙˆØµÙˆÙ„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„
            setTimeout(() => {
                form.submit();
            }, 500);
        };
    </script>
</body>
</html>
